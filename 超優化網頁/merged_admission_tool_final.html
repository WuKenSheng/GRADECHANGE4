
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>æ™ºæ…§å‡å­¸è©•ä¼°å·¥å…·ï¼ˆåˆä½µç‰ˆï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body>
  <h2>è©•ä¼°æ¸…å–®</h2>
  <div id="evaluationList"></div>

  <script>
    const subjectWeights = ["åœ‹å€ç‡", "è‹±å€ç‡", "æ•¸Aå€ç‡", "æ•¸Bå€ç‡", "ç¤¾æœƒå€ç‡", "è‡ªç„¶å€ç‡", "æ•¸ç”²å€ç‡", "ç‰©å€ç‡", "åŒ–å€ç‡", "ç”Ÿå€ç‡", "æ­·å€ç‡", "åœ°å€ç‡", "å…¬å€ç‡"];
    const advancedSubjects = ["æ•¸ç”²", "ç‰©", "åŒ–", "ç”Ÿ", "æ­·", "åœ°", "å…¬"];
    const userScores = {
      "åœ‹æ–‡": {min: 10, max: 13},
      "è‹±æ–‡": {min: 8, max: 12},
      "æ•¸A": {min: 9, max: 12},
      "æ•¸B": {min: 7, max: 10},
      "ç¤¾æœƒ": {min: 6, max: 9},
      "è‡ªç„¶": {min: 7, max: 11}
    };
    const evaluationData = [{
      "å¹´åº¦": "113",
      "æ ¡å": "åœ‹ç«‹ç¯„ä¾‹å¤§å­¸",
      "ç³»çµ„å": "è³‡è¨Šå·¥ç¨‹å­¸ç³»",
      "æ™®é€šç”ŸéŒ„å–åˆ†æ•¸": "420",
      "éŒ„å–äººæ•¸": "50",
      "åœ‹å€ç‡": "1.25", "è‹±å€ç‡": "1.25", "æ•¸Aå€ç‡": "1.5", "æ•¸Bå€ç‡": "0", "ç¤¾æœƒå€ç‡": "1",
      "è‡ªç„¶å€ç‡": "1", "æ•¸ç”²å€ç‡": "1.5", "ç‰©å€ç‡": "1", "åŒ–å€ç‡": "0.5", "ç”Ÿå€ç‡": "0",
      "æ­·å€ç‡": "0", "åœ°å€ç‡": "0", "å…¬å€ç‡": "0"
    }];

    function renderEvaluationList() {
      const elist = document.getElementById('evaluationList');
      elist.innerHTML = '';
      evaluationData.forEach((dept, idx) => {
        const minScore = parseFloat(dept['æ™®é€šç”ŸéŒ„å–åˆ†æ•¸']) || 0;
        let totalHigh = 0, totalLow = 0, advancedWeightSum = 0;

        const mapping = {
          'åœ‹æ–‡': 'åœ‹å€ç‡', 'è‹±æ–‡': 'è‹±å€ç‡', 'æ•¸A': 'æ•¸Aå€ç‡',
          'æ•¸B': 'æ•¸Bå€ç‡', 'ç¤¾æœƒ': 'ç¤¾æœƒå€ç‡', 'è‡ªç„¶': 'è‡ªç„¶å€ç‡'
        };

        for (let sub in mapping) {
          const weightKey = mapping[sub];
          const weight = parseFloat(dept[weightKey] || 0);
          const score = userScores[sub] || { min: 0, max: 0 };
          totalHigh += score.max * weight;
          totalLow += score.min * weight;
        }

        advancedSubjects.forEach(sub => {
          const weight = parseFloat(dept[sub + 'å€ç‡'] || 0);
          advancedWeightSum += weight;
        });

        const avgMin = ((minScore - totalHigh) / (advancedWeightSum || 1)).toFixed(2);
        const avgMax = ((minScore - totalLow) / (advancedWeightSum || 1)).toFixed(2);

        elist.innerHTML += `
          <div><strong>${idx+1}. ${dept['å¹´åº¦']} ${dept['æ ¡å']} ${dept['ç³»çµ„å']}</strong><br>
          å„ç§‘å€ç‡ï¼š${subjectWeights.map(w => `${w}: ${dept[w] || 0}`).join(' ï½œ ')}<br>
          æœ€ä½éŒ„å–åˆ†æ•¸ï¼š${minScore} ï½œ éŒ„å–äººæ•¸ï¼š${dept['éŒ„å–äººæ•¸'] || 'N/A'}<br>
          ğŸ”¹ æœ€ä½åˆ†ç§‘å–®ç§‘å¹³å‡ç´šåˆ†ï¼š${avgMin} ï½œ ğŸ”¸ æœ€é«˜åˆ†ç§‘å–®ç§‘å¹³å‡ç´šåˆ†ï¼š${avgMax}<br><hr></div>`;
      });
      elist.innerHTML += `<button onclick="generatePDF()">ğŸ“„ ç”¢ç”Ÿ PDF å ±è¡¨</button>`;
    }

    async function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(14);
      doc.text("å‡å­¸è©•ä¼°æ¸…å–®å ±è¡¨", 10, 10);
      let y = 20;

      evaluationData.forEach((dept, idx) => {
        const minScore = parseFloat(dept['æ™®é€šç”ŸéŒ„å–åˆ†æ•¸']) || 0;
        let totalHigh = 0, totalLow = 0, advancedWeightSum = 0;
        const mapping = {
          'åœ‹æ–‡': 'åœ‹å€ç‡', 'è‹±æ–‡': 'è‹±å€ç‡', 'æ•¸A': 'æ•¸Aå€ç‡',
          'æ•¸B': 'æ•¸Bå€ç‡', 'ç¤¾æœƒ': 'ç¤¾æœƒå€ç‡', 'è‡ªç„¶': 'è‡ªç„¶å€ç‡'
        };
        for (let sub in mapping) {
          const weight = parseFloat(dept[mapping[sub]] || 0);
          const score = userScores[sub] || { min: 0, max: 0 };
          totalHigh += score.max * weight;
          totalLow += score.min * weight;
        }
        advancedSubjects.forEach(sub => {
          const weight = parseFloat(dept[sub + 'å€ç‡'] || 0);
          advancedWeightSum += weight;
        });
        const avgMin = ((minScore - totalHigh) / (advancedWeightSum || 1)).toFixed(2);
        const avgMax = ((minScore - totalLow) / (advancedWeightSum || 1)).toFixed(2);

        const lines = [
          `${idx + 1}. ${dept['å¹´åº¦']} ${dept['æ ¡å']} ${dept['ç³»çµ„å']}`,
          `æœ€ä½éŒ„å–åˆ†æ•¸: ${minScore}ï¼ŒéŒ„å–äººæ•¸: ${dept['éŒ„å–äººæ•¸'] || 'N/A'}`,
          `æœ€ä½å¹³å‡ç´šåˆ†: ${avgMin}ï¼Œæœ€é«˜å¹³å‡ç´šåˆ†: ${avgMax}`,
          `å„ç§‘å€ç‡: ${subjectWeights.map(w => `${w}:${dept[w] || 0}`).join('ï½œ')}`
        ];

        lines.forEach(line => {
          if (y > 270) { doc.addPage(); y = 20; }
          doc.text(line, 10, y);
          y += 8;
        });

        y += 4;
      });

      doc.save("å‡å­¸è©•ä¼°å ±è¡¨.pdf");
    }

    renderEvaluationList();
  </script>
</body>
</html>
